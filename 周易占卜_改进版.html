<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã€Šå‘¨æ˜“ã€‹è¿‡æ²æ³•æ¨¡æ‹Ÿå™¨</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="yijing_data.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
font-family: 'Noto Serif SC', serif;
}

/* çˆ»è±¡å®¹å™¨çš„æ•´ä½“æ ·å¼ */
.hexagram-line {
display: flex;
align-items: center;
justify-content: center;
margin: 8px 0;
height: 20px;
transition: all 0.3s ease-in-out;
}

.hexagram-line:hover {
transform: scale(1.05);
}

/* çˆ»è±¡è§†è§‰éƒ¨åˆ†çš„å®¹å™¨ */
.line-visual-container {
width: 140px;
height: 100%;
display: flex;
align-items: center;
}

/* é˜³çˆ»ï¼šå®Œæ•´çš„é•¿æ¡ */
.line-yang-vis {
width: 100%;
height: 12px;
background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
border-radius: 4px;
box-shadow: 0 2px 4px rgba(251, 191, 36, 0.3);
}

/* é˜´çˆ»å®¹å™¨ */
.line-yin-vis {
width: 100%;
height: 12px;
display: flex;
justify-content: space-between;
}

/* é˜´çˆ»ç‰‡æ®µ */
.line-yin-segment {
width: 33%;
height: 100%;
background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
border-radius: 4px;
box-shadow: 0 2px 4px rgba(156, 163, 175, 0.3);
}

/* å˜çˆ»æ ‡è®° */
.changing-marker {
width: 30px;
text-align: center;
color: #ef4444;
font-size: 1.25rem;
font-weight: bold;
text-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
.custom-scrollbar::-webkit-scrollbar {
width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
background: #1f2937;
border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
background: #4b5563;
border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
background: #6b7280;
}

/* æŒ‰é’®åŠ¨ç”» */
@keyframes pulse-glow {
0%, 100% {
box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
}
50% {
box-shadow: 0 0 30px rgba(251, 191, 36, 0.8);
}
}

.btn-cast {
animation: pulse-glow 2s infinite;
}

/* å¦è±¡å¡ç‰‡æ¸å…¥åŠ¨ç”» */
@keyframes fadeInUp {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.fade-in-up {
animation: fadeInUp 0.5s ease-out;
}
</style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-200 flex flex-col items-center min-h-screen p-4">
<div class="w-full max-w-5xl mx-auto">
<!-- é¡µå¤´ -->
<header class="text-center my-8 fade-in-up">
<h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500 mb-2">
ã€Šå‘¨æ˜“ã€‹è¿‡æ²æ³•æ¨¡æ‹Ÿå™¨
</h1>
<p class="text-gray-400 text-lg">ä»¥ç®—æ³•å†ç°å¤å…¸æ™ºæ…§ï¼Œæ¢å¯»å¤©åœ°ç„æœº</p>
<div class="mt-4 text-sm text-gray-500">
<p>é‡‡ç”¨ä¼ ç»Ÿã€Œåˆ†äºŒã€æŒ‚ä¸€ã€æ²å››ã€å½’å¥‡ã€ä¹‹æ³•</p>
</div>
</header>

<!-- é—®é¢˜è¾“å…¥åŒº -->
<div class="my-8 px-4 fade-in-up" style="animation-delay: 0.1s;">
<div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 shadow-xl">
<label for="questionInput" class="block mb-3 text-xl font-semibold text-amber-300">
ğŸ“¿ æ‰€é—®ä¹‹äº‹
</label>
<textarea 
id="questionInput" 
rows="3" 
class="w-full p-4 bg-gray-900/80 border border-gray-600 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition text-lg resize-none" 
placeholder="é™å¿ƒå‡ç¥ï¼Œè¾“å…¥æ‚¨æƒ³å é—®çš„é—®é¢˜...&#10;ä¾‹å¦‚ï¼šäº‹ä¸šå‰ç¨‹å¦‚ä½•ï¼Ÿæ„Ÿæƒ…æ˜¯å¦é¡ºé‚ï¼Ÿ"></textarea>
<div class="mt-3 text-sm text-gray-500">
ğŸ’¡ æç¤ºï¼šå¿ƒè¯šåˆ™çµï¼Œé—®é¢˜å®œç®€æ´æ˜äº†
</div>
</div>
</div>

<!-- èµ·å¦æŒ‰é’® -->
<div class="text-center my-8">
<button 
id="castButton" 
class="btn-cast bg-gradient-to-r from-amber-600 to-yellow-600 hover:from-amber-700 hover:to-yellow-700 text-white font-bold py-4 px-12 rounded-xl shadow-2xl transition-all transform hover:scale-105 text-lg">
ğŸ”® å¼€å§‹æ¨æ¼”
</button>
</div>

<!-- ç»“æœæ˜¾ç¤ºåŒº -->
<div id="results" class="hidden">
<!-- é—®é¢˜æ˜¾ç¤º -->
<div id="questionDisplayContainer" class="mb-8 bg-gradient-to-r from-gray-800 to-gray-800/50 backdrop-blur-sm p-6 rounded-xl border border-amber-900/50 shadow-xl fade-in-up">
<h3 class="text-xl font-bold text-amber-400 border-b border-amber-900/50 pb-3 mb-3 flex items-center">
<span class="mr-2">ğŸ“œ</span> æ‰€é—®ä¹‹äº‹
</h3>
<p id="questionDisplay" class="text-gray-200 text-xl leading-relaxed"></p>
</div>

<!-- ä¸»è¦å†…å®¹åŒºï¼šæ¨æ¼”è¿‡ç¨‹ + å¦è±¡ -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<!-- æ¨æ¼”è¿‡ç¨‹ -->
<div class="lg:col-span-1 fade-in-up" style="animation-delay: 0.1s;">
<div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 p-5 rounded-xl h-[500px] overflow-y-auto custom-scrollbar shadow-xl">
<h3 class="text-lg font-bold text-amber-400 border-b border-gray-600 pb-3 mb-3 sticky top-0 bg-gray-800/90 backdrop-blur-sm flex items-center">
<span class="mr-2">âš™ï¸</span> æ¨æ¼”è¿‡ç¨‹
</h3>
<div id="processLog" class="text-sm font-mono text-gray-400 whitespace-pre-wrap leading-relaxed"></div>
</div>
</div>

<!-- å¦è±¡æ˜¾ç¤º -->
<div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
<!-- æœ¬å¦ -->
<div class="fade-in-up" style="animation-delay: 0.2s;">
<div class="bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 p-6 rounded-xl flex flex-col items-center shadow-2xl">
<h3 class="text-2xl font-bold text-amber-400 mb-6 flex items-center">
<span class="mr-2">â˜°</span> æœ¬å¦
</h3>
<div id="originalHexagramDisplay" class="w-full mb-6"></div>
<div id="originalHexagramInfo" class="text-left w-full max-h-[600px] overflow-y-auto custom-scrollbar"></div>
</div>
</div>

<!-- ä¹‹å¦ -->
<div class="fade-in-up" style="animation-delay: 0.3s;">
<div class="bg-gradient-to-br from-gray-800 to-gray-900 border border-gray-700 p-6 rounded-xl flex flex-col items-center shadow-2xl">
<h3 class="text-2xl font-bold text-amber-400 mb-6 flex items-center">
<span class="mr-2">â˜·</span> ä¹‹å¦
</h3>
<div id="changedHexagramDisplay" class="w-full mb-6"></div>
<div id="changedHexagramInfo" class="text-left w-full max-h-[600px] overflow-y-auto custom-scrollbar"></div>
</div>
</div>
</div>
</div>

<!-- è§£è¯»æç¤º -->
<div class="mt-8 bg-gray-800/30 backdrop-blur-sm border border-gray-700/50 p-6 rounded-xl fade-in-up" style="animation-delay: 0.4s;">
<h3 class="text-lg font-bold text-amber-400 mb-3 flex items-center">
<span class="mr-2">ğŸ’­</span> è§£è¯»æç¤º
</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-400">
<div>
<p class="mb-2"><span class="text-amber-500 font-bold">æœ¬å¦ï¼š</span>å½“å‰çŠ¶æ€ï¼Œäº‹ç‰©çš„ç°çŠ¶</p>
<p class="mb-2"><span class="text-amber-500 font-bold">ä¹‹å¦ï¼š</span>æœªæ¥è¶‹åŠ¿ï¼Œäº‹ç‰©çš„å‘å±•æ–¹å‘</p>
</div>
<div>
<p class="mb-2"><span class="text-red-400 font-bold">å˜çˆ»ï¼š</span>æ ‡è®° O(è€é˜³) æˆ– X(è€é˜´) è¡¨ç¤ºä¼šå‘ç”Ÿå˜åŒ–çš„çˆ»ä½</p>
<p class="mb-2"><span class="text-gray-500 font-bold">ä¸å˜çˆ»ï¼š</span>å°‘é˜³(7)ã€å°‘é˜´(8)ä¿æŒç¨³å®š</p>
</div>
</div>
</div>
</div>

<!-- é¡µè„š -->
<footer class="text-center mt-12 mb-6 text-gray-500 text-sm">
<p>ã€Šå‘¨æ˜“ã€‹æ›°ï¼šã€Œæ˜“ä¸å¤©åœ°å‡†ï¼Œæ•…èƒ½å¼¥çº¶å¤©åœ°ä¹‹é“ã€</p>
<p class="mt-2">â€” æ­¤æ¨¡æ‹Ÿå™¨ä»…ä¾›å­¦ä¹ äº¤æµï¼Œå åœç»“æœä»…ä¾›å‚è€ƒ â€”</p>
</footer>
</div>

<script>
// å®Œæ•´çš„64å¦æ•°æ®
const hexagramData = {
'111111': { name: 'ä¹¾', pinyin: 'qiÃ¡n', description: 'ä¹¾ä¸ºå¤©', number: 1 },
'000000': { name: 'å¤', pinyin: 'kÅ«n', description: 'å¤ä¸ºåœ°', number: 2 },
'100010': { name: 'å±¯', pinyin: 'zhÅ«n', description: 'æ°´é›·å±¯', number: 3 },
'010001': { name: 'è’™', pinyin: 'mÃ©ng', description: 'å±±æ°´è’™', number: 4 },
'111010': { name: 'éœ€', pinyin: 'xÅ«', description: 'æ°´å¤©éœ€', number: 5 },
'010111': { name: 'è®¼', pinyin: 'sÃ²ng', description: 'å¤©æ°´è®¼', number: 6 },
'010000': { name: 'å¸ˆ', pinyin: 'shÄ«', description: 'åœ°æ°´å¸ˆ', number: 7 },
'000010': { name: 'æ¯”', pinyin: 'bÇ', description: 'æ°´åœ°æ¯”', number: 8 },
'111011': { name: 'å°ç•œ', pinyin: 'xiÇo xÃ¹', description: 'é£å¤©å°ç•œ', number: 9 },
'110111': { name: 'å±¥', pinyin: 'lÇš', description: 'å¤©æ³½å±¥', number: 10 },
'111000': { name: 'æ³°', pinyin: 'tÃ i', description: 'åœ°å¤©æ³°', number: 11 },
'000111': { name: 'å¦', pinyin: 'pÇ', description: 'å¤©åœ°å¦', number: 12 },
'101111': { name: 'åŒäºº', pinyin: 'tÃ³ng rÃ©n', description: 'å¤©ç«åŒäºº', number: 13 },
'111101': { name: 'å¤§æœ‰', pinyin: 'dÃ  yÇ’u', description: 'ç«å¤©å¤§æœ‰', number: 14 },
'001000': { name: 'è°¦', pinyin: 'qiÄn', description: 'åœ°å±±è°¦', number: 15 },
'000100': { name: 'è±«', pinyin: 'yÃ¹', description: 'é›·åœ°è±«', number: 16 },
'100110': { name: 'éš', pinyin: 'suÃ­', description: 'æ³½é›·éš', number: 17 },
'011001': { name: 'è›Š', pinyin: 'gÇ”', description: 'å±±é£è›Š', number: 18 },
'110000': { name: 'ä¸´', pinyin: 'lÃ­n', description: 'åœ°æ³½ä¸´', number: 19 },
'000011': { name: 'è§‚', pinyin: 'guÄn', description: 'é£åœ°è§‚', number: 20 },
'100101': { name: 'å™¬å—‘', pinyin: 'shÃ¬ hÃ©', description: 'ç«é›·å™¬å—‘', number: 21 },
'101001': { name: 'è´²', pinyin: 'bÃ¬', description: 'å±±ç«è´²', number: 22 },
'000001': { name: 'å‰¥', pinyin: 'bÅ', description: 'å±±åœ°å‰¥', number: 23 },
'100000': { name: 'å¤', pinyin: 'fÃ¹', description: 'åœ°é›·å¤', number: 24 },
'100111': { name: 'æ— å¦„', pinyin: 'wÃº wÃ ng', description: 'å¤©é›·æ— å¦„', number: 25 },
'111001': { name: 'å¤§ç•œ', pinyin: 'dÃ  xÃ¹', description: 'å±±å¤©å¤§ç•œ', number: 26 },
'100001': { name: 'é¢', pinyin: 'yÃ­', description: 'å±±é›·é¢', number: 27 },
'011110': { name: 'å¤§è¿‡', pinyin: 'dÃ  guÃ²', description: 'æ³½é£å¤§è¿‡', number: 28 },
'010010': { name: 'å', pinyin: 'kÇn', description: 'åä¸ºæ°´', number: 29 },
'101101': { name: 'ç¦»', pinyin: 'lÃ­', description: 'ç¦»ä¸ºç«', number: 30 },
'001110': { name: 'å’¸', pinyin: 'xiÃ¡n', description: 'æ³½å±±å’¸', number: 31 },
'011100': { name: 'æ’', pinyin: 'hÃ©ng', description: 'é›·é£æ’', number: 32 },
'001111': { name: 'é', pinyin: 'dÃ¹n', description: 'å¤©å±±é', number: 33 },
'111100': { name: 'å¤§å£®', pinyin: 'dÃ  zhuÃ ng', description: 'é›·å¤©å¤§å£®', number: 34 },
'000101': { name: 'æ™‹', pinyin: 'jÃ¬n', description: 'ç«åœ°æ™‹', number: 35 },
'101000': { name: 'æ˜å¤·', pinyin: 'mÃ­ng yÃ­', description: 'åœ°ç«æ˜å¤·', number: 36 },
'101011': { name: 'å®¶äºº', pinyin: 'jiÄ rÃ©n', description: 'é£ç«å®¶äºº', number: 37 },
'110101': { name: 'ç½', pinyin: 'kuÃ­', description: 'ç«æ³½ç½', number: 38 },
'001010': { name: 'è¹‡', pinyin: 'jiÇn', description: 'æ°´å±±è¹‡', number: 39 },
'010100': { name: 'è§£', pinyin: 'xiÃ¨', description: 'é›·æ°´è§£', number: 40 },
'110001': { name: 'æŸ', pinyin: 'sÇ”n', description: 'å±±æ³½æŸ', number: 41 },
'100011': { name: 'ç›Š', pinyin: 'yÃ¬', description: 'é£é›·ç›Š', number: 42 },
'111110': { name: 'å¤¬', pinyin: 'guÃ i', description: 'æ³½å¤©å¤¬', number: 43 },
'011111': { name: 'å§¤', pinyin: 'gÃ²u', description: 'å¤©é£å§¤', number: 44 },
'000110': { name: 'èƒ', pinyin: 'cuÃ¬', description: 'æ³½åœ°èƒ', number: 45 },
'011000': { name: 'å‡', pinyin: 'shÄ“ng', description: 'åœ°é£å‡', number: 46 },
'010110': { name: 'å›°', pinyin: 'kÃ¹n', description: 'æ³½æ°´å›°', number: 47 },
'011010': { name: 'äº•', pinyin: 'jÇng', description: 'æ°´é£äº•', number: 48 },
'101110': { name: 'é©', pinyin: 'gÃ©', description: 'æ³½ç«é©', number: 49 },
'011101': { name: 'é¼', pinyin: 'dÇng', description: 'ç«é£é¼', number: 50 },
'100100': { name: 'éœ‡', pinyin: 'zhÃ¨n', description: 'éœ‡ä¸ºé›·', number: 51 },
'001001': { name: 'è‰®', pinyin: 'gÃ¨n', description: 'è‰®ä¸ºå±±', number: 52 },
'001011': { name: 'æ¸', pinyin: 'jiÃ n', description: 'é£å±±æ¸', number: 53 },
'110100': { name: 'å½’å¦¹', pinyin: 'guÄ« mÃ¨i', description: 'é›·æ³½å½’å¦¹', number: 54 },
'101100': { name: 'ä¸°', pinyin: 'fÄ“ng', description: 'é›·ç«ä¸°', number: 55 },
'001101': { name: 'æ—…', pinyin: 'lÇš', description: 'ç«å±±æ—…', number: 56 },
'011011': { name: 'å·½', pinyin: 'xÃ¹n', description: 'å·½ä¸ºé£', number: 57 },
'110110': { name: 'å…‘', pinyin: 'duÃ¬', description: 'å…‘ä¸ºæ³½', number: 58 },
'010011': { name: 'æ¶£', pinyin: 'huÃ n', description: 'é£æ°´æ¶£', number: 59 },
'110010': { name: 'èŠ‚', pinyin: 'jiÃ©', description: 'æ°´æ³½èŠ‚', number: 60 },
'110011': { name: 'ä¸­å­š', pinyin: 'zhÅng fÃº', description: 'é£æ³½ä¸­å­š', number: 61 },
'001100': { name: 'å°è¿‡', pinyin: 'xiÇo guÃ²', description: 'é›·å±±å°è¿‡', number: 62 },
'101010': { name: 'æ—¢æµ', pinyin: 'jÃ¬ jÃ¬', description: 'æ°´ç«æ—¢æµ', number: 63 },
'010101': { name: 'æœªæµ', pinyin: 'wÃ¨i jÃ¬', description: 'ç«æ°´æœªæµ', number: 64 }
};

// ä¼ ç»Ÿçˆ»ä½å‘½åå‡½æ•°
function getTraditionalLineName(lineValue, position) {
const isYang = (lineValue === 7 || lineValue === 9);
const yinYangChar = isYang ? 'ä¹' : 'å…­';
switch(position) {
case 1:
return `åˆ${yinYangChar}`;
case 6:
return `ä¸Š${yinYangChar}`;
default:
return `${yinYangChar}${['', '', 'äºŒ', 'ä¸‰', 'å››', 'äº”'][position]}`;
}
}

const castButton = document.getElementById('castButton');
const processLog = document.getElementById('processLog');
const resultsDiv = document.getElementById('results');
const questionInput = document.getElementById('questionInput');
const questionDisplay = document.getElementById('questionDisplay');

castButton.addEventListener('click', castHexagram);

// èµ·å¦ä¸»å‡½æ•°
function castHexagram() {
const question = questionInput.value.trim();
questionDisplay.textContent = question || 'å¿ƒè¯šåˆ™çµï¼ŒæœªæŒ‡å®šå…·ä½“é—®é¢˜ã€‚';

// æ˜¾ç¤ºç»“æœåŒºåŸŸ
resultsDiv.classList.remove('hidden');
processLog.innerHTML = '';

// æ·»åŠ åŠ è½½åŠ¨ç”»
processLog.innerHTML = '<div class="text-center text-amber-400">ğŸ”® æ­£åœ¨æ¨æ¼”ä¸­...</div>';
castButton.disabled = true;
castButton.textContent = 'æ¨æ¼”ä¸­...';

// å»¶è¿Ÿæ‰§è¡Œä»¥æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
setTimeout(() => {
let lines = [];
let log = '';

for (let i = 0; i < 6; i++) {
log += `â”â”â” æ±‚ç¬¬ ${i + 1} çˆ» â”â”â”\n`;
const { lineValue, process } = getSingleLine();
lines.push(lineValue);
log += process + '\n';
}

processLog.textContent = log;
displayHexagrams(lines);

castButton.disabled = false;
castButton.textContent = 'ğŸ”® å¼€å§‹æ¨æ¼”';

// æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}, 300);
}

// è·å–å•ä¸ªçˆ»çš„å‡½æ•°ï¼ˆè¿‡æ²æ³•ï¼‰
function getSingleLine() {
let stalks = 49;
let process = '';

for (let change = 1; change <= 3; change++) {
process += `ç¬¬ ${change} å˜ (ä½™ ${stalks} æ ¹):\n`;

// åˆ†äºŒï¼šéšæœºåˆ†æˆå·¦å³ä¸¤å †
const leftPile = Math.floor(Math.random() * (stalks - 2)) + 1;
const rightPile = stalks - leftPile;
process += `  åˆ†äºŒ: å·¦=${leftPile}, å³=${rightPile}\n`;

// æŒ‚ä¸€ï¼šä»å³å †å–å‡ºä¸€æ ¹
const guaYi = 1;

// æ²å››ï¼šå·¦å³ä¸¤å †åˆ†åˆ«é™¤ä»¥4å–ä½™æ•°
let remLeft = leftPile % 4;
if (remLeft === 0) remLeft = 4;
let remRight = (rightPile - guaYi) % 4;
if (remRight === 0) remRight = 4;

process += `  æŒ‚ä¸€: ä»å³å †å– 1 æ ¹æŒ‚èµ·\n`;
process += `  æ²å››: å·¦ä½™=${remLeft}, å³ä½™=${remRight}\n`;

// å½’å¥‡ï¼šå°†ä½™æ•°å½’äºä¸€å¤„
const removed = guaYi + remLeft + remRight;
stalks -= removed;
process += `  å½’å¥‡: æœ¬å˜ç§»å» ${removed} æ ¹ (æŒ‚ä¸€${guaYi} + å·¦ä½™${remLeft} + å³ä½™${remRight})\n`;
process += `  å‰©ä½™: ${stalks} æ ¹\n`;
}

// ä¸‰å˜ä¹‹åï¼Œå‰©ä½™çš„è“è‰æ•°é™¤ä»¥4å¾—åˆ°çˆ»å€¼
const lineValue = stalks / 4;
const lineNames = {6: 'è€é˜´(å˜)', 7: 'å°‘é˜³(ä¸å˜)', 8: 'å°‘é˜´(ä¸å˜)', 9: 'è€é˜³(å˜)'};
process += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
process += `æœ€ç»ˆ: ${stalks} æ ¹ Ã· 4 = ${lineValue} [${lineNames[lineValue]}]\n`;

return { lineValue, process };
}

// æ˜¾ç¤ºæœ¬å¦å’Œä¹‹å¦
function displayHexagrams(lines) {
displaySingleHexagram('original', lines);

// è®¡ç®—ä¹‹å¦ï¼ˆå˜çˆ»ï¼‰
const changedLines = lines.map(line => {
if (line === 6) return 7; // è€é˜´å˜å°‘é˜³
if (line === 9) return 8; // è€é˜³å˜å°‘é˜´
return line;
});

const hasChanged = JSON.stringify(lines) !== JSON.stringify(changedLines);
displaySingleHexagram('changed', changedLines, !hasChanged);
}

// æ˜¾ç¤ºå•ä¸ªå¦è±¡
function displaySingleHexagram(type, lines, isSameAsOriginal = false) {
const displayDiv = document.getElementById(`${type}HexagramDisplay`);
const infoDiv = document.getElementById(`${type}HexagramInfo`);

displayDiv.innerHTML = '';
infoDiv.innerHTML = '';

// ä»ä¸‹åˆ°ä¸Šæ˜¾ç¤ºçˆ»ï¼ˆåè½¬æ•°ç»„ï¼‰
[...lines].reverse().forEach((lineValue, index) => {
const lineDiv = document.createElement('div');
lineDiv.className = 'hexagram-line';

let lineVisualHTML = '';
let changingText = '&nbsp;';
let changingClass = '';
let lineName = '';

// é˜´çˆ»æˆ–é˜³çˆ»
if (lineValue === 6 || lineValue === 8) {
// é˜´çˆ»
lineVisualHTML = `
<div class="line-visual-container">
<div class="line-yin-vis">
<div class="line-yin-segment"></div>
<div class="line-yin-segment"></div>
</div>
</div>`;
lineName = lineValue === 6 ? 'è€é˜´' : 'å°‘é˜´';
if (lineValue === 6) {
changingText = 'X';
changingClass = 'font-bold';
}
} else {
// é˜³çˆ»
lineVisualHTML = `
<div class="line-visual-container">
<div class="line-yang-vis"></div>
</div>`;
lineName = lineValue === 7 ? 'å°‘é˜³' : 'è€é˜³';
if (lineValue === 9) {
changingText = 'O';
changingClass = 'font-bold';
}
}

const linePosition = 6 - index;
const traditionalName = getTraditionalLineName(lineValue, linePosition);

lineDiv.innerHTML = `
<span class="text-sm text-gray-500 mr-3 w-14 text-right font-medium">${traditionalName}</span>
${lineVisualHTML}
<span class="changing-marker ${changingClass}">${type === 'original' ? changingText : '&nbsp;'}</span>
<span class="text-xs text-gray-500 ml-2 w-20 text-left">${lineValue} Â· ${lineName}</span>
`;

displayDiv.appendChild(lineDiv);
});

// æ˜¾ç¤ºå¦è±¡ä¿¡æ¯
const hexagramInfo = getHexagramInfo(lines);

if (hexagramInfo) {
// è·å–å¦è¾å’Œçˆ»è¾æ•°æ®
const yijingText = yijingTexts[hexagramInfo.number];
let extraInfo = '';
if (isSameAsOriginal) {
extraInfo = '<p class="text-amber-600 mt-3 text-sm border-t border-gray-700 pt-3">âš ï¸ æ— å˜çˆ»ï¼Œä¹‹å¦åŒæœ¬å¦</p>';
}

// æ„å»ºå¦è¾æ˜¾ç¤º
let guaciHTML = '';
if (yijingText) {
guaciHTML = `
<div class="mt-4 border-t border-gray-700 pt-4">
<h4 class="text-amber-400 font-bold mb-2">å¦è¾</h4>
<p class="text-gray-300 leading-relaxed">${yijingText.guaci}</p>
</div>
`;

// å¦‚æœæ˜¯æœ¬å¦ï¼Œæ˜¾ç¤ºå½–ä¼ å’Œè±¡ä¼ 
if (type === 'original') {
guaciHTML += `
<div class="mt-3">
<h4 class="text-amber-400 font-bold mb-2">ã€Šå½–ã€‹æ›°</h4>
<p class="text-gray-300 text-sm leading-relaxed">${yijingText.tuan}</p>
</div>
<div class="mt-3">
<h4 class="text-amber-400 font-bold mb-2">ã€Šè±¡ã€‹æ›°</h4>
<p class="text-gray-300 text-sm leading-relaxed">${yijingText.daxiang}</p>
</div>
`;
}

// æ˜¾ç¤ºå˜çˆ»çš„çˆ»è¾
guaciHTML += '<div class="mt-4 border-t border-gray-700 pt-4">';
guaciHTML += '<h4 class="text-amber-400 font-bold mb-3">çˆ»è¾</h4>';

// æ‰¾å‡ºå˜çˆ»ï¼ˆlinesæ•°ç»„ä»åˆçˆ»åˆ°ä¸Šçˆ»ï¼Œindex 0-5å¯¹åº”ç¬¬1-6çˆ»ï¼‰
lines.forEach((lineValue, index) => {
if (type === 'original' && (lineValue === 6 || lineValue === 9)) {
// è¿™æ˜¯å˜çˆ»ï¼Œæ˜¾ç¤ºå…¶çˆ»è¾
if (yijingText.yaos && yijingText.yaos[index]) {
const yao = yijingText.yaos[index];
guaciHTML += `
<div class="mb-3 bg-gray-800/50 p-3 rounded-lg border-l-4 border-red-500">
<p class="text-red-400 font-bold mb-1">${yao.name}ï¼ˆå˜çˆ»ï¼‰</p>
<p class="text-gray-300 text-sm mb-1">${yao.text}</p>
<p class="text-gray-500 text-xs">ã€Šè±¡ã€‹æ›°ï¼š${yao.xiang}</p>
</div>
`;
}
}
});

// å¦‚æœæ²¡æœ‰å˜çˆ»ï¼Œæ˜¾ç¤ºæ‰€æœ‰çˆ»è¾
if (type === 'original' && !lines.some(l => l === 6 || l === 9)) {
yijingText.yaos.forEach((yao, idx) => {
if (idx < 6) { // åªæ˜¾ç¤ºå…­çˆ»ï¼Œä¸æ˜¾ç¤ºç”¨ä¹/ç”¨å…­
guaciHTML += `
<div class="mb-2 text-sm">
<span class="text-amber-300 font-medium">${yao.name}ï¼š</span>
<span class="text-gray-400">${yao.text}</span>
</div>
`;
}
});
}

guaciHTML += '</div>';
}

infoDiv.innerHTML = `
<div class="bg-gray-900/50 rounded-lg p-4 border border-gray-700">
<p class="text-3xl font-bold text-amber-300 mb-2">${hexagramInfo.name}</p>
<p class="text-gray-400 text-lg mb-1">${hexagramInfo.description}</p>
<p class="text-sm text-gray-500">ç¬¬ ${hexagramInfo.number} å¦</p>
${extraInfo}
${guaciHTML}
</div>
`;
} else {
infoDiv.innerHTML = `<p class="text-red-400 text-lg">âš ï¸ æœªæ‰¾åˆ°å¦è±¡æ•°æ®</p>`;
}
}

// è·å–å¦è±¡ä¿¡æ¯
function getHexagramInfo(lines) {
const binaryKey = lines.map(l => (l === 7 || l === 9) ? '1' : '0').join('');
return hexagramData[binaryKey] || null;
}

// å›è½¦é”®è§¦å‘èµ·å¦
questionInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter' && e.ctrlKey) {
castHexagram();
}
});
</script>
</body>
</html>
